<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Cart | Boho Blackboard</title>

  <link rel="icon" type="image/png" href="BB_favicon.png">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Quicksand:wght@400;500&display=swap" rel="stylesheet">
</head>

<body>

<header>
  <h1 class="logo">Boho Blackboard</h1>
  <div class="swoosh"></div>

  <!-- MOBILE MENU BUTTON -->
  <div class="hamburger" onclick="toggleMenu()">
    <div></div><div></div><div></div>
  </div>
</header>

<nav class="sticky">
  <ul class="nav-links">

    <li><a href="index.html" class="active">Home</a></li>
    <li><a href="about.html">About</a></li>

    <li class="dropdown">
      <a href="resources.html">Resources ▾</a>
      <ul class="dropdown-content">
        <li><a href="pdf-products.html">PDF Products</a></li>
        <li><a href="classroom-themes.html">Classroom Themes</a></li>
        <li><a href="freebies.html">Freebies</a></li>
      </ul>
    </li>

    <li class="dropdown">
      <a href="#">Legal ▾</a>
      <ul class="dropdown-content">
        <li><a href="terms.html">Terms</a></li>
        <li><a href="privacy.html">Privacy</a></li>
        <li><a href="refund.html">Refund Policy</a></li>
        <li><a href="downloads.html">Digital Delivery</a></li>
      </ul>
    </li>

    <li><a href="contact.html">Contact</a></li>
    <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>

  </ul>
</nav>


<section class="sub-banner">
  <img src="cartb.png" alt="Cart Banner">
</section>

<main class="content">
  <h2>Your Cart</h2>
  <p class="intro">Review your selected items before checking out.</p>

  <div id="cart-items"></div>

  <h3 style="text-align:center;">
    Total: <span id="cart-total">R0</span>
  </h3>

  <!-- EMAIL INPUT -->
  <div style="text-align:center; margin-top:20px;">
    <label><strong>Your Email for Download Delivery:</strong></label><br>
    <input type="email" id="customerEmail"
           placeholder="you@email.com"
           style="padding:8px; width:300px; margin-top:10px;" required>
  </div>

  <!-- PAYFAST CHECKOUT -->
  <form id="payfast-form" action="https://www.payfast.co.za/eng/process" method="post"
        style="text-align:center; margin-top:20px;" onsubmit="return prepareCheckout();">

    <!-- Required Fields -->
    <input type="hidden" name="merchant_id" value="32490751">
    <input type="hidden" name="merchant_key" value="f4fwd1jmilk9g">

    <!-- Dynamic -->
    <input type="hidden" id="pf-amount" name="amount">
    <input type="hidden" name="item_name" value="Boho Blackboard Purchase">

    <!-- Return URLs -->
    <input type="hidden" id="pf-return" name="return_url" value="">
    <input type="hidden" name="cancel_url" value="https://bohoblackboard.github.io/boho/cancel.html">

    <button type="submit" class="checkout-btn">Pay with PayFast</button>
  </form>
</main>

<footer>
  © 2025 Boho Blackboard | Designed from the heart by Danielle Droste
</footer>

<script src="cart.js"></script>

<script>
function updateTotals() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  let total = cart.reduce((sum, item) => sum + item.price, 0);
  document.getElementById("cart-total").textContent = "R" + total;
}

document.addEventListener("DOMContentLoaded", () => {
  updateCartPage();
  updateCartCount();
  updateTotals();
});

function prepareCheckout() {
  const email = document.getElementById("customerEmail").value.trim();
  if (!email) {
    alert("Please enter your email before paying.");
    return false;
  }

  const cart = JSON.parse(localStorage.getItem("cart")) || [];

  let total = cart.reduce((sum, item) => sum + item.price, 0);
  document.getElementById("pf-amount").value = total;

  // ONE SAFE PARAMETER
  const payload = { email: email, cart: cart };
  const encoded = encodeURIComponent(JSON.stringify(payload));

  // RETURN URL
  document.getElementById("pf-return").value =
    "https://bohoblackboard.github.io/boho/success.html?data=" + encoded;

  return true;
}
</script>

</body>
</html>
