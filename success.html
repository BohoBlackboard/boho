<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Thank You | Boho Blackboard</title>

  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="BB_favicon.png">

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    .thankyou-box {
      background: #fffaf5;
      padding: 2rem;
      border-radius: 22px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.10);
      max-width: 700px;
      margin: 2rem auto;
    }

    .back-btn {
      display: inline-block;
      margin-top: 1.5rem;
      background: #a7b59f;
      color: white;
      padding: 0.8rem 2rem;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      transition: 0.2s;
    }

    .back-btn:hover {
      background: #8fa48b;
    }
  </style>
</head>

<body>

<header>
  <h1 class="logo">Boho Blackboard</h1>
  <div class="swoosh"></div>
</header>

<nav class="sticky">
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="about.html">About</a></li>

    <li class="dropdown">
      <a href="resources.html">Resources ‚ñæ</a>
      <ul class="dropdown-content">
        <li><a href="pdf-products.html">PDF Products</a></li>
        <li><a href="classroom-themes.html">Classroom Themes</a></li>
        <li><a href="freebies.html">Freebies</a></li>
      </ul>
    </li>

    <li class="dropdown">
      <a href="#">Legal ‚ñæ</a>
      <ul class="dropdown-content">
        <li><a href="terms.html">Terms</a></li>
        <li><a href="privacy.html">Privacy</a></li>
        <li><a href="refund.html">Refund Policy</a></li>
        <li><a href="downloads.html">Digital Delivery</a></li>
      </ul>
    </li>

    <li><a href="contact.html">Contact</a></li>
    <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
  </ul>
</nav>

<section class="sub-banner">
  <img src="thank-you.png" alt="">
</section>

<main class="content thankyou-box" style="text-align:center;">
  <h2>Thank You for Your Purchase! üéâ</h2>
  <p>Your download links are being emailed to you now. üíõ</p>
  <p>If you do not receive an email within 2 minutes, please check your spam folder.</p>

  <h3 id="status-message" style="margin-top:20px; font-size:1.1rem;"></h3>

  <a href="index.html" class="back-btn">‚Üê Back to Shop</a>
</main>

<footer>
  ¬© 2025 Boho Blackboard | Designed from the heart by Danielle Droste
</footer>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
// ----------------------------------------------
// EmailJS init
// ----------------------------------------------
emailjs.init("_RstzO3AfSZ0UV3y7");

// ----------------------------------------------
// Load purchase data
// ----------------------------------------------
function getPurchaseData() {
  const urlParams = new URLSearchParams(window.location.search);
  const encoded = urlParams.get("data");

  if (!encoded) return null;

  try {
    return JSON.parse(decodeURIComponent(encoded));
  } catch {
    return null;
  }
}

let purchaseData = getPurchaseData();

// ----------------------------------------------
// Fallback for manual testing
// ----------------------------------------------
if (!purchaseData) {
  purchaseData = {
    email: localStorage.getItem("customer_email") || "",
    cart: JSON.parse(localStorage.getItem("cart") || "[]"),
    preview: true
  };
}

const email = purchaseData.email;
const cart = purchaseData.cart;
const previewMode = purchaseData.preview || false;

const statusBox = document.getElementById("status-message");

// ----------------------------------------------
// VALID CODE-LINK LIST
// ----------------------------------------------
const fileLinks = {
  "DSH_EN": "https://bohoblackboard.github.io/boho/downloads/boho-dachshunds.zip",
  "DSH_AF": "https://bohoblackboard.github.io/boho/downloads/boho-dachshunds-afrikaans.zip",
  "OWL_EN": "https://bohoblackboard.github.io/boho/downloads/boho-owls.zip",
  "OWL_AF": "https://bohoblackboard.github.io/boho/downloads/boho-owls-afrikaans.zip",
  "BEAR_EN": "https://bohoblackboard.github.io/boho/downloads/boho-bears.zip",
  "BEAR_AF": "https://bohoblackboard.github.io/boho/downloads/boho-bears-afrikaans.zip",
};

// Friendly names
const friendlyNames = {
  "DSH_EN": "Boho Dachshunds ‚Äì English",
  "DSH_AF": "Boho Worshonde ‚Äì Afrikaans",
  "OWL_EN": "Boho Owls ‚Äì English",
  "OWL_AF": "Boho Uile ‚Äì Afrikaans",
  "BEAR_EN": "Boho Bears ‚Äì English",
  "BEAR_AF": "Boho Bere ‚Äì Afrikaans"
};

// ----------------------------------------------
// Build product_list for EmailJS
// ----------------------------------------------
function buildList() {
  return cart.map(item => {
    if (!item.code) return "";
    return `${friendlyNames[item.code]}:\n${fileLinks[item.code]}\n`;
  }).join("\n");
}

// ----------------------------------------------
// Send Email if real purchase
// ----------------------------------------------
if (previewMode) {
  statusBox.textContent = "You are previewing this page. Download links are only sent after a successful checkout.";
} else {
  sendDownloadEmail();
}

function sendDownloadEmail() {
  const productList = buildList();

  const params = {
    customer_email: email,
    product_list: productList
  };

  emailjs.send("service_96euu0a", "template_2ib1ulk", params)
    .then(() => {
      statusBox.textContent = "üì® Your download links have been sent!";
      localStorage.removeItem("cart");
      localStorage.removeItem("customer_email");

      // Confetti celebration!
      confetti({ particleCount: 80, spread: 60 });
    })
    .catch(() => {
      statusBox.textContent = "‚ö† Email could not be sent. Please contact support.";
    });
}
</script>

</body>
</html>
