<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thank You | Boho Blackboard</title>

  <link rel="icon" type="image/png" href="bb favicon.png">
  <link rel="stylesheet" href="style.css">

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>

<body>

<header>
  <h1 class="logo">Boho Blackboard</h1>
  <div class="swoosh"></div>
</header>

<section class="sub-banner">
  <img src="banner.png" alt="Success Banner">
</section>

<main class="content" style="text-align:center;">
  <h2>Thank You for Your Purchase!</h2>
  <p>Your download links are being emailed to you now.</p>
  <p>If you do not receive an email within 2 minutes, please check spam/junk.</p>

  <h3 id="status" style="margin-top:20px;"></h3>
</main>

<footer>
  © 2025 Boho Blackboard | Designed from the heart by Danielle Droste
</footer>

<script>
// EmailJS init
emailjs.init("_RstzO3AfSZ0UV3y7");

// Read payload
const params = new URLSearchParams(window.location.search);
let payload = {};

try {
  if (params.get("data")) {
    payload = JSON.parse(decodeURIComponent(params.get("data")));
  }
} catch (e) {
  console.error("Failed to parse payload", e);
}

const customerEmail = payload.email || "";
const cart = payload.cart || [];

// URLs for all products
const downloadLinks = {
  "DASH_EN": "https://bohoblackboard.github.io/boho/downloads/boho-dachshunds.zip",
  "DASH_AF": "https://bohoblackboard.github.io/boho/downloads/boho-dachshunds-afrikaans.zip",

  "BRS_EN": "https://bohoblackboard.github.io/boho/downloads/boho-bears-english.zip",
  "BRS_AF": "https://bohoblackboard.github.io/boho/downloads/boho-bears-afrikaans.zip",

  "BUN_EN": "https://bohoblackboard.github.io/boho/downloads/boho-bunnies-english.zip",
  "BUN_AF": "https://bohoblackboard.github.io/boho/downloads/boho-bunnies-afrikaans.zip",

  "OWL_EN": "https://bohoblackboard.github.io/boho/downloads/boho-owls.zip",
  "OWL_AF": "https://bohoblackboard.github.io/boho/downloads/boho-owls-afrikaans.zip",

  "RNG_EN": "https://bohoblackboard.github.io/boho/downloads/boho-ringnecks-english.zip",
  "RNG_AF": "https://bohoblackboard.github.io/boho/downloads/boho-ringnecks-afrikaans.zip",

  "SQR_EN": "https://bohoblackboard.github.io/boho/downloads/boho-squirrels-english.zip",
  "SQR_AF": "https://bohoblackboard.github.io/boho/downloads/boho-squirrels-afrikaans.zip"
};

// Build email text
let messageLinks = "";
cart.forEach(item => {
  if (downloadLinks[item.code]) {
    messageLinks += `${item.name}: ${downloadLinks[item.code]}\n`;
  }
});

// Send email
if (customerEmail && messageLinks) {
  emailjs
    .send("service_96euu0a", "template_wxt1tto", {
      customer_email: customerEmail,
      product_name: "Your Boho Blackboard Downloads",
      download_link: messageLinks
    })
    .then(() => {
      document.getElementById("status").textContent =
        "Your download email has been sent successfully! ❤️";
    })
    .catch(err => {
      console.error("Email failed:", err);
      document.getElementById("status").textContent =
        "⚠ We could not send your download email. Please contact support.";
    });
} else {
  document.getElementById("status").textContent =
    "⚠ Missing purchase data. Please contact support.";
}
</script>

</body>
</html>
